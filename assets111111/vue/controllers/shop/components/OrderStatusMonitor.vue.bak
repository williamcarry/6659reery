<template>
  <Teleport to="body" v-if="isVisible">
    <!-- ËÉåÊôØÈÅÆÁΩ© - Á¶ÅÊ≠¢ÁÇπÂáªÂÖ≥Èó≠ -->
    <div 
      class="fixed inset-0 bg-black/35 z-40"
    ></div>

    <!-- Ê®°ÊÄÅÂØπËØùÊ°Ü -->
    <div class="fixed bg-white rounded-lg shadow-xl z-50" :style="{ width: '550px', maxHeight: '75vh', top: '50%', left: '50%', transform: 'translate(-50%, -50%)' }">
      <!-- Ê†áÈ¢òÊ†è -->
      <div class="flex items-center justify-between h-12 px-4 border-b border-gray-200 bg-white rounded-t-lg">
        <h2 class="text-base font-medium text-gray-800">{{ currentStatus === 'processing' ? t('processingTitle') : currentStatus === 'success' ? t('successTitle') : t('failedTitle') }}</h2>
        <!-- Âè™ÊúâÂú®ÊàêÂäüÊàñÂ§±Ë¥•Êó∂ÊâçÊòæÁ§∫ÂÖ≥Èó≠ÊåâÈíÆ -->
        <button 
          v-if="currentStatus !== 'processing'"
          type="button" 
          class="text-gray-400 hover:text-gray-600 transition-colors" 
          @click="close"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- ÂÜÖÂÆπÂå∫Âüü -->
      <div class="overflow-y-auto" :style="{ maxHeight: 'calc(75vh - 100px)' }">
        <div class="p-4">
          <!-- Â§ÑÁêÜ‰∏≠Áä∂ÊÄÅ -->
          <div v-if="currentStatus === 'processing'" class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-blue-600 mx-auto mb-4"></div>
            <h3 class="text-base font-semibold text-gray-800 mb-2">{{ t('processingTitle') }}</h3>
            <p class="text-sm text-gray-600 mb-2">{{ t('orderNoLabel') }}{{ orderNo }}</p>
            <p class="text-xs text-gray-500">{{ statusMessage }}</p>
          </div>

          <!-- ÊàêÂäüÁä∂ÊÄÅ -->
          <div v-else-if="currentStatus === 'success'">
            <!-- Â¶ÇÊûúÊòæÁ§∫ Payoneer ÊîØ‰ªòÁªÑ‰ª∂ -->
            <div v-if="showPayoneerPayment && customerInfo">
              <PayoneerPayment
                payment-type="order_payment"
                :amount="orderAmount"
                :order-no="orderNo"
                :customer-email="customerInfo.email"
                :customer-first-name="customerInfo.firstName"
                :customer-last-name="customerInfo.lastName"
                :currency="siteCurrency"
                :currency-symbol="currencySymbol"
                @payment-success="handlePayoneerSuccess"
                @payment-error="handlePayoneerError"
              />
            </div>
            
            <!-- ÊîØ‰ªòÊñπÂºèÈÄâÊã© -->
            <div v-else>
              <!-- ËÆ¢ÂçïÁîüÊàêÊàêÂäüÊèêÁ§∫ -->
              <div class="text-center mb-6">
                <div class="text-5xl mb-4">üéâ</div>
                <h3 class="text-base font-semibold text-gray-800 mb-2">{{ t('successTitle') }}</h3>
                <p class="text-sm text-gray-600 mb-2">{{ t('orderNoLabel') }}{{ orderNo }}</p>
                <p class="text-xs text-gray-500 mb-4">{{ t('successMessage') }}</p>
              </div>
              
              <!-- ÊîØ‰ªòÊñπÂºèÈÄâÊã© -->
              <div>
                <p class="text-base font-medium text-gray-900 mb-4">{{ t('selectPaymentMethod') }}</p>
                
                <div class="grid grid-cols-3 gap-4 mb-6">
                  <!-- ‰ΩôÈ¢ùÊîØ‰ªò -->
                  <div
                    class="flex flex-col items-center justify-center w-full p-4 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md"
                    :class="selectedPaymentMethod === 'balance' ? 'border-purple-500 bg-purple-50' : 'border-gray-300 bg-white hover:border-gray-400'"
                    @click="selectedPaymentMethod = 'balance'"
                  >
                    <svg class="w-12 h-12 mb-3 text-purple-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-sm font-medium text-gray-800 text-center">{{ t('balancePay') }}</span>
                  </div>

                  <!-- Payoneer -->
                  <div
                    class="flex flex-col items-center justify-center w-full p-4 border-2 rounded-lg cursor-pointer transition-all hover:shadow-md"
                    :class="selectedPaymentMethod === 'payoneer' ? 'border-cyan-500 bg-cyan-50' : 'border-gray-300 bg-white hover:border-gray-400'"
                    @click="selectedPaymentMethod = 'payoneer'"
                  >
                    <img
                      :alt="t('payoneer')"
                      loading="lazy"
                      src="/frondend/images/ItemDetailPage/payoneer.png"
                      class="w-12 h-12 mb-3 flex-shrink-0"
                      onerror="this.src='https://via.placeholder.com/48?text=Payoneer'"
                    />
                    <span class="text-sm font-medium text-gray-800 text-center">{{ t('payoneer') }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Â§±Ë¥•Áä∂ÊÄÅ -->
          <div v-else-if="currentStatus === 'failed'" class="text-center">
            <div class="text-5xl mb-4">‚ö†Ô∏è</div>
            <h3 class="text-base font-semibold text-gray-800 mb-2">{{ t('failedTitle') }}</h3>
            <p class="text-sm text-red-600 mb-2">{{ errorMessage }}</p>
            <p class="text-xs text-gray-500">{{ t('failedMessage') }}</p>
          </div>
        </div>
      </div>

      <!-- Â∫ïÈÉ®Êìç‰ΩúÊåâÈíÆ -->
      <div class="flex items-center justify-end gap-2 h-12 px-4 border-t border-gray-200 bg-white rounded-b-lg">
        <!-- ËÆ¢ÂçïÁîüÊàêÊàêÂäüÂêéÊòæÁ§∫Á°ÆËÆ§ÊîØ‰ªòÊåâÈíÆ -->
        <button
          v-if="currentStatus === 'success'"
          type="button"
          class="px-4 py-2 text-xs font-medium text-white rounded transition-colors inline-flex items-center justify-center min-h-8"
          :class="{ 'opacity-50 cursor-not-allowed': !selectedPaymentMethod || isProcessingPayment }"
          :disabled="!selectedPaymentMethod || isProcessingPayment"
          style="background-color: #FF6600;"
          @click="handleConfirmPayment"
          @mouseenter="$event.target.style.backgroundColor = (!selectedPaymentMethod || isProcessingPayment) ? '#FF6600' : '#FF7722'"
          @mouseleave="$event.target.style.backgroundColor = '#FF6600'"
        >
          {{ isProcessingPayment ? t('processingPayment') : t('confirmPayment') }}
        </button>
        <!-- Â§±Ë¥•Êó∂ÊòæÁ§∫ÂÖ≥Èó≠ÊåâÈíÆ -->
        <button
          v-if="currentStatus === 'failed'"
          type="button"
          class="px-4 py-2 text-xs font-medium text-white rounded transition-colors inline-flex items-center justify-center min-h-8"
          style="background-color: #FF6600;"
          @click="close"
          @mouseenter="$event.target.style.backgroundColor = '#FF7722'"
          @mouseleave="$event.target.style.backgroundColor = '#FF6600'"
        >
          {{ t('btnClose') }}
        </button>
      </div>
    </div>
  </Teleport>
</template>

<script setup>
import { ref, watch, onBeforeUnmount, onMounted, computed } from 'vue'
import { ElMessage } from 'element-plus'
import apiSignature from '../services/apiSignature.js'
import encryptionService from '../data/encryption-service.js'
import PayoneerPayment from './PayoneerPayment.vue'

// È°µÈù¢ÁøªËØëÊï∞ÊçÆ
const translations = ref({})

// ÂΩìÂâçËØ≠Ë®ÄÔºà‰ªé localStorage ËØªÂèñÂàùÂßãÂÄºÔºâ
const currentLang = ref(localStorage.getItem('app.lang') || 'zh-CN')

// Âä†ËΩΩÁøªËØëÊñá‰ª∂
const loadTranslations = async () => {
  try {
    const response = await fetch('/frondend/lang/OrderStatusMonitor.json')
    const data = await response.json()
    translations.value = data
  } catch (error) {
    console.error('Failed to load translations:', error)
  }
}

// ÁøªËØëÂáΩÊï∞
const t = (key) => {
  const lang = currentLang.value
  if (translations.value[lang] && translations.value[lang][key]) {
    return translations.value[lang][key]
  }
  return key
}

// ÁõëÂê¨ËØ≠Ë®ÄÂèòÂåñ‰∫ã‰ª∂
const handleLangChange = (event) => {
  if (event.detail && event.detail.lang) {
    currentLang.value = event.detail.lang
  }
  loadTranslations()
}

const props = defineProps({
  isVisible: {
    type: Boolean,
    default: false
  },
  orderNo: {
    type: String,
    default: ''
  }
})

const emit = defineEmits(['close', 'ready', 'paymentSuccess'])

const currentStatus = ref('processing')
const statusMessage = ref('')
const errorMessage = ref('')
const eventSource = ref(null)
const isConnecting = ref(false) // Èò≤Ê≠¢ÈáçÂ§çËøûÊé•
const hasEmittedReady = ref(false) // Èò≤Ê≠¢ÈáçÂ§çËß¶Âèë ready ‰∫ã‰ª∂
const selectedPaymentMethod = ref(null) // ÈÄâ‰∏≠ÁöÑÊîØ‰ªòÊñπÂºè
const isProcessingPayment = ref(false) // ÊòØÂê¶Ê≠£Âú®Â§ÑÁêÜÊîØ‰ªò
const showPayoneerPayment = ref(false) // ÊòØÂê¶ÊòæÁ§∫ Payoneer ÊîØ‰ªòÁªÑ‰ª∂
const customerInfo = ref(null) // ÂÆ¢Êà∑‰ø°ÊÅØ
const orderAmount = ref(0) // ËÆ¢ÂçïÈáëÈ¢ù
const siteCurrency = ref('USD') // ÁΩëÁ´ôÂ∏ÅÁßç
const currencySymbol = ref('$') // Ë¥ßÂ∏ÅÁ¨¶Âè∑

const resetStatus = () => {
  currentStatus.value = 'processing'
  statusMessage.value = t('msgInitializing')
  errorMessage.value = ''
  hasEmittedReady.value = false // ÈáçÁΩÆ ready Ê†áÂøó
  selectedPaymentMethod.value = null // ÈáçÁΩÆÊîØ‰ªòÊñπÂºèÈÄâÊã©
  isProcessingPayment.value = false // ÈáçÁΩÆÊîØ‰ªòÂ§ÑÁêÜÁä∂ÊÄÅ
  showPayoneerPayment.value = false // ÈáçÁΩÆ Payoneer ÊîØ‰ªòÁªÑ‰ª∂ÊòæÁ§∫
}

watch(() => props.orderNo, (newOrderNo, oldOrderNo) => {
  // Âè™Âú® orderNo ‰ªéÊó†Âà∞ÊúâÔºå‰∏îÂºπÁ™óÂèØËßÅÊó∂ÊâçÂª∫Á´ãËøûÊé•
  if (newOrderNo && !oldOrderNo && props.isVisible) {
    resetStatus()
    subscribeMercure(newOrderNo)
  }
})

watch(() => props.isVisible, (visible) => {
  if (!visible) {
    closeMercureConnection()
    isConnecting.value = false
    setTimeout(() => {
      resetStatus()
    }, 300)
  } else if (props.orderNo && !isConnecting.value && !eventSource.value) {
    // ÂºπÁ™óÊòæÁ§∫‰∏îÊúâËÆ¢ÂçïÂè∑‰∏îÊ≤°ÊúâËøûÊé•Êó∂ÔºåÂª∫Á´ãËøûÊé•
    resetStatus()
    subscribeMercure(props.orderNo)
  }
})

const subscribeMercure = async (orderNo) => {
  // Èò≤Ê≠¢ÈáçÂ§çËøûÊé• - ÂêåÊ≠•ËÆæÁΩÆÊ†áÂøó‰Ωç
  if (isConnecting.value || eventSource.value) {
    console.warn('Mercure ËøûÊé•Â∑≤Â≠òÂú®ÊàñÊ≠£Âú®Âª∫Á´ã‰∏≠ÔºåË∑≥Ëøá')
    return
  }
  
  // Á´ãÂç≥ËÆæÁΩÆÊ†áÂøó‰ΩçÔºåÈò≤Ê≠¢Âπ∂ÂèëË∞ÉÁî®
  isConnecting.value = true
  
  // ÂΩªÂ∫ïÂÖ≥Èó≠ÊóßËøûÊé•
  closeMercureConnection()
  
  try {
    const tokenResponse = await fetch(`/api/mercure/token?orderNo=${encodeURIComponent(orderNo)}`, {
      credentials: 'include'
    })
    
    const tokenData = await tokenResponse.json()
    
    if (!tokenData.success || !tokenData.token) {
      currentStatus.value = 'failed'
      errorMessage.value = t('msgConnectionFailed')
      isConnecting.value = false
      return
    }
    
    const mercureUrl = new URL('http://127.0.0.1:3000/.well-known/mercure')
    mercureUrl.searchParams.append('topic', tokenData.topic)
    const finalUrl = `${mercureUrl.toString()}&authorization=${tokenData.token}`
    
    eventSource.value = new EventSource(finalUrl)
    
    eventSource.value.onopen = () => {
      statusMessage.value = t('msgConnected')
      isConnecting.value = false
      
      // Âè™Ëß¶Âèë‰∏ÄÊ¨° ready ‰∫ã‰ª∂
      if (!hasEmittedReady.value) {
        hasEmittedReady.value = true
        emit('ready')
      }
    }
    
    eventSource.value.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data)
        handleMercureMessage(data)
      } catch (e) {
        console.error('Ê∂àÊÅØËß£ÊûêÂ§±Ë¥•:', e)
      }
    }
    
    eventSource.value.onerror = () => {
      isConnecting.value = false
      if (eventSource.value?.readyState === EventSource.CLOSED) {
        currentStatus.value = 'failed'
        errorMessage.value = t('msgConnectionFailed')
      }
    }
  } catch (error) {
    console.error('ÂàõÂª∫ Mercure ËøûÊé•Â§±Ë¥•:', error)
    currentStatus.value = 'failed'
    errorMessage.value = t('msgConnectionFailed')
    isConnecting.value = false
  }
}

const handleMercureMessage = (data) => {
  // Ê†πÊçÆÂΩìÂâçËØ≠Ë®ÄÈÄâÊã©ÊòæÁ§∫ÁöÑÊ∂àÊÅØ
  const getMessage = (data) => {
    if (currentLang.value === 'en' && data.messageEn) {
      return data.messageEn
    }
    return data.message || ''
  }
  
  // ‰ºòÂåñÔºöÁÆÄÂåñÊ≠•È™§Â§ÑÁêÜÔºåÂè™ÂÖ≥Ê≥®ÂÖ≥ÈîÆÁä∂ÊÄÅ
  switch (data.step) {
    case 'completed':
      currentStatus.value = 'success'
      // ÊàêÂäüÂêéÁ´ãÂç≥ÂΩªÂ∫ïÊ∏ÖÁêÜËøûÊé•
      cleanupConnection()
      break
      
    case 'failed':
    case 'error':
      currentStatus.value = 'failed'
      errorMessage.value = getMessage(data) || t('msgFailed')
      // Â§±Ë¥•Âêé‰πüË¶ÅÂΩªÂ∫ïÊ∏ÖÁêÜËøûÊé•
      cleanupConnection()
      break
      
    default:
      // ‰ªª‰ΩïÂÖ∂‰ªñÊ≠•È™§ÈÉΩÂè™Êõ¥Êñ∞Áä∂ÊÄÅÊ∂àÊÅØ
      if (data.message || data.messageEn) {
        statusMessage.value = getMessage(data)
      }
  }
}

const closeMercureConnection = () => {
  if (eventSource.value) {
    eventSource.value.close()
    eventSource.value = null
  }
  isConnecting.value = false
}

// ÂΩªÂ∫ïÊ∏ÖÁêÜÊâÄÊúâËøûÊé•ÂíåÁä∂ÊÄÅ
const cleanupConnection = () => {
  console.log('üßπ ÂºÄÂßãÂΩªÂ∫ïÊ∏ÖÁêÜ Mercure ËøûÊé•ÂíåÁä∂ÊÄÅ...')
  
  // 1. ÂÖ≥Èó≠ EventSource ËøûÊé•
  if (eventSource.value) {
    try {
      eventSource.value.close()
      console.log('‚úÖ EventSource Â∑≤ÂÖ≥Èó≠')
    } catch (e) {
      console.error('‚ùå ÂÖ≥Èó≠ EventSource Â§±Ë¥•:', e)
    }
    eventSource.value = null
  }
  
  // 2. ÈáçÁΩÆÊâÄÊúâÊ†áÂøó‰Ωç
  isConnecting.value = false
  hasEmittedReady.value = false
  
  // 3. Ê∏ÖÈô§Áä∂ÊÄÅÊ∂àÊÅØÔºà‰ΩÜ‰øùÁïô currentStatusÔºåÁî®‰∫éÊòæÁ§∫ÁªìÊûúÔºâ
  // statusMessage ‰øùÁïôÊúÄÂêé‰∏ÄÊù°Ê∂àÊÅØÔºå‰æõÁî®Êà∑Êü•Áúã
  
  console.log('‚úÖ Mercure ËøûÊé•ÂíåÁä∂ÊÄÅÂ∑≤ÂΩªÂ∫ïÊ∏ÖÁêÜ')
}

const close = () => {
  // ÂÖ≥Èó≠ÂºπÁ™óÂâçÂÖàÂΩªÂ∫ïÊ∏ÖÁêÜ
  cleanupConnection()
  emit('close')
}

// Á°ÆËÆ§ÊîØ‰ªò
const handleConfirmPayment = async () => {
  if (!selectedPaymentMethod.value || isProcessingPayment.value) {
    return
  }
  
  // Â¶ÇÊûúÈÄâÊã©ÁöÑÊòØ PayoneerÔºåÊòæÁ§∫ Payoneer ÊîØ‰ªòÁªÑ‰ª∂
  if (selectedPaymentMethod.value === 'payoneer') {
    // Ëé∑ÂèñÂÆ¢Êà∑‰ø°ÊÅØÂíåËÆ¢ÂçïÈáëÈ¢ù
    await fetchOrderInfo()
    showPayoneerPayment.value = true
    return
  }
  
  // ‰ΩôÈ¢ùÊîØ‰ªò
  isProcessingPayment.value = true
  
  try {
    // ÂáÜÂ§áËØ∑Ê±ÇÊï∞ÊçÆ
    const requestData = {
      orderNo: props.orderNo,
      paymentMethod: selectedPaymentMethod.value
    }
    
    // Âä†ÂØÜÊï¥‰∏™JSONÂØπË±°
    const encryptedData = encryptionService.prepareData(requestData, true)
    
    // ÁîüÊàêAPIÁ≠æÂêç
    const signedData = apiSignature.sign(encryptedData)
    
    // Ë∞ÉÁî®ÂêéÁ´Ø API Êõ¥Êñ∞ÊîØ‰ªòÊñπÂºè
    const response = await fetch('/shop/api/order/update-payment-method', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      },
      credentials: 'include',
      body: JSON.stringify(signedData)
    })
    
    const result = await response.json()
    
    if (result.success) {
      const lang = currentLang.value
      ElMessage.success(lang === 'en' ? result.messageEn || 'Payment successful!' : result.message || 'ÊîØ‰ªòÊàêÂäüÔºÅ')
      
      // Ëß¶ÂèëÊîØ‰ªòÊàêÂäü‰∫ã‰ª∂
      emit('paymentSuccess', { orderNo: props.orderNo })
      
      // ÂÖ≥Èó≠ÂºπÁ™ó
      setTimeout(() => {
        close()
      }, 1000)
    } else {
      const lang = currentLang.value
      ElMessage.error(lang === 'en' ? result.messageEn || 'Payment failed' : result.message || 'ÊîØ‰ªòÂ§±Ë¥•')
      isProcessingPayment.value = false
    }
  } catch (error) {
    console.error('ÊîØ‰ªòÂ§ÑÁêÜÂ§±Ë¥•:', error)
    const lang = currentLang.value
    ElMessage.error(lang === 'en' ? 'Payment processing failed' : 'ÊîØ‰ªòÂ§ÑÁêÜÂ§±Ë¥•')
    isProcessingPayment.value = false
  }
}

// Ëé∑ÂèñËÆ¢Âçï‰ø°ÊÅØÔºàÁî®‰∫é Payoneer ÊîØ‰ªòÔºâ
const fetchOrderInfo = async () => {
  try {
    // ÂáÜÂ§áËØ∑Ê±ÇÊï∞ÊçÆ
    const requestData = {
      orderNo: props.orderNo
    }
    
    // Âä†ÂØÜÊï¥‰∏™JSONÂØπË±°
    const encryptedData = encryptionService.prepareData(requestData, true)
    
    // ÁîüÊàêAPIÁ≠æÂêç
    const signedData = apiSignature.sign(encryptedData)
    
    const response = await fetch('/shop/api/order/detail', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Requested-With': 'XMLHttpRequest'
      },
      credentials: 'include',
      body: JSON.stringify(signedData)
    })
    
    const result = await response.json()
    
    if (result.success && result.data) {
      const order = result.data
      customerInfo.value = {
        email: order.customer?.email || '',
        firstName: order.customer?.realName || order.customer?.username || '',
        lastName: ''
      }
      orderAmount.value = parseFloat(order.totalAmount || 0)
      siteCurrency.value = order.currency || 'USD'
      currencySymbol.value = order.currencySymbol || '$'
    } else {
      throw new Error(result.message || 'Failed to fetch order info')
    }
  } catch (error) {
    console.error('Ëé∑ÂèñËÆ¢Âçï‰ø°ÊÅØÂ§±Ë¥•:', error)
    ElMessage.error(t('msgFailed'))
    showPayoneerPayment.value = false
    isProcessingPayment.value = false
  }
}

// Payoneer ÊîØ‰ªòÊàêÂäüÂõûË∞É
const handlePayoneerSuccess = () => {
  // Payoneer ‰ºöË∑≥ËΩ¨Âà∞ÊîØ‰ªòÈ°µÈù¢Ôºå‰∏çÈúÄË¶ÅÂú®ËøôÈáåÂ§ÑÁêÜ
}

// Payoneer ÊîØ‰ªòÈîôËØØÂõûË∞É
const handlePayoneerError = (error) => {
  console.error('Payoneer ÊîØ‰ªòÈîôËØØ:', error)
  showPayoneerPayment.value = false
  isProcessingPayment.value = false
  ElMessage.error(t('msgFailed'))
}

onMounted(() => {
  loadTranslations()
  window.addEventListener('languagechange', handleLangChange)
})

onBeforeUnmount(() => {
  // ÁªÑ‰ª∂ÈîÄÊØÅÊó∂‰ΩøÁî®ÂΩªÂ∫ïÊ∏ÖÁêÜ
  cleanupConnection()
  window.removeEventListener('languagechange', handleLangChange)
})
</script>

<style scoped>
/* Âä®Áîª */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.animate-spin {
  animation: spin 1s linear infinite;
}

/* Teleport Ê†∑Âºè */
:deep(.fixed.inset-0) {
  background-color: rgba(0, 0, 0, 0.35) !important;
}

:deep(.fixed.bg-white) {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12) !important;
  border-radius: 6px !important;
}

:deep(.flex.items-center.justify-between.h-12) {
  height: 50px !important;
  padding: 0 16px !important;
}

:deep(.text-base.font-medium.text-gray-800) {
  color: #333333 !important;
  font-size: 16px !important;
  font-weight: 600 !important;
}

:deep(.text-gray-400.hover\:text-gray-600) {
  color: #bfbfbf !important;
  transition: color 0.2s ease !important;
}

:deep(.text-gray-400.hover\:text-gray-600:hover) {
  color: #FF6600 !important;
}

:deep(.overflow-y-auto) {
  background-color: #ffffff !important;
}

:deep(.text-center) {
  text-align: center;
}

:deep(.text-5xl) {
  font-size: 48px;
  line-height: 1;
}

:deep(.text-base.font-semibold.text-gray-800) {
  color: #333333 !important;
  font-size: 16px !important;
  font-weight: 600 !important;
}

:deep(.text-sm.text-gray-600) {
  color: #666666 !important;
  font-size: 14px !important;
}

:deep(.text-xs.text-gray-500) {
  color: #999999 !important;
  font-size: 12px !important;
}

:deep(.text-sm.text-red-600) {
  color: #ff4d4f !important;
  font-size: 14px !important;
}

:deep(.flex.items-center.justify-end.gap-2.h-12) {
  height: 50px !important;
  padding: 0 16px !important;
  gap: 8px !important;
}

:deep(.text-white.rounded) {
  color: #ffffff !important;
  background-color: #FF6600 !important;
  border: none !important;
  border-radius: 4px !important;
  padding: 8px 16px !important;
  font-size: 12px !important;
  font-weight: 500 !important;
  cursor: pointer !important;
  transition: all 0.2s ease !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  min-height: 32px !important;
}

:deep(.text-white.rounded:hover) {
  background-color: #FF7722 !important;
  box-shadow: 0 2px 8px rgba(255, 102, 0, 0.15) !important;
}

@media (max-width: 900px) {
  :deep(.fixed.bg-white) {
    width: 85% !important;
    max-width: 520px !important;
  }
}

@media (max-width: 640px) {
  :deep(.fixed.bg-white) {
    width: 90% !important;
    max-width: 450px !important;
  }
}

/* ÊîØ‰ªòÊñπÂºèÈÄâÊã©Ê†∑Âºè */
.grid.grid-cols-3.gap-4 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
}

.border-purple-500 {
  border-color: #a855f7 !important;
}

.bg-purple-50 {
  background-color: #faf5ff;
}

.border-cyan-500 {
  border-color: #06b6d4 !important;
}

.bg-cyan-50 {
  background-color: #ecf8ff;
}
</style>
